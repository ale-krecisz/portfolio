{"ast":null,"code":"'use strict';\n\nexports.__esModule = true;\nexports.parse = parse;\n\nexports.default = function () {\n  return function bitmapFontParser(resource, next) {\n    // skip if no data or not xml data\n    if (!resource.data || resource.type !== _resourceLoader.Resource.TYPE.XML) {\n      next();\n      return;\n    } // skip if not bitmap font data, using some silly duck-typing\n\n\n    if (resource.data.getElementsByTagName('page').length === 0 || resource.data.getElementsByTagName('info').length === 0 || resource.data.getElementsByTagName('info')[0].getAttribute('face') === null) {\n      next();\n      return;\n    }\n\n    var xmlUrl = !resource.isDataUrl ? path.dirname(resource.url) : '';\n\n    if (resource.isDataUrl) {\n      if (xmlUrl === '.') {\n        xmlUrl = '';\n      }\n\n      if (this.baseUrl && xmlUrl) {\n        // if baseurl has a trailing slash then add one to xmlUrl so the replace works below\n        if (this.baseUrl.charAt(this.baseUrl.length - 1) === '/') {\n          xmlUrl += '/';\n        }\n      }\n    } // remove baseUrl from xmlUrl\n\n\n    xmlUrl = xmlUrl.replace(this.baseUrl, ''); // if there is an xmlUrl now, it needs a trailing slash. Ensure that it does if the string isn't empty.\n\n    if (xmlUrl && xmlUrl.charAt(xmlUrl.length - 1) !== '/') {\n      xmlUrl += '/';\n    }\n\n    var pages = resource.data.getElementsByTagName('page');\n    var textures = {}; // Handle completed, when the number of textures\n    // load is the same number as references in the fnt file\n\n    var completed = function completed(page) {\n      textures[page.metadata.pageFile] = page.texture;\n\n      if (Object.keys(textures).length === pages.length) {\n        parse(resource, textures);\n        next();\n      }\n    };\n\n    for (var i = 0; i < pages.length; ++i) {\n      var pageFile = pages[i].getAttribute('file');\n      var url = xmlUrl + pageFile;\n      var exists = false; // incase the image is loaded outside\n      // using the same loader, resource will be available\n\n      for (var name in this.resources) {\n        var bitmapResource = this.resources[name];\n\n        if (bitmapResource.url === url) {\n          bitmapResource.metadata.pageFile = pageFile;\n\n          if (bitmapResource.texture) {\n            completed(bitmapResource);\n          } else {\n            bitmapResource.onAfterMiddleware.add(completed);\n          }\n\n          exists = true;\n          break;\n        }\n      } // texture is not loaded, we'll attempt to add\n      // it to the load and add the texture to the list\n\n\n      if (!exists) {\n        // Standard loading options for images\n        var options = {\n          crossOrigin: resource.crossOrigin,\n          loadType: _resourceLoader.Resource.LOAD_TYPE.IMAGE,\n          metadata: Object.assign({\n            pageFile: pageFile\n          }, resource.metadata.imageMetadata),\n          parentResource: resource\n        };\n        this.add(url, options, completed);\n      }\n    }\n  };\n};\n\nvar _path = require('path');\n\nvar path = _interopRequireWildcard(_path);\n\nvar _resourceLoader = require('resource-loader');\n\nvar _extras = require('../extras');\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n/**\n * Register a BitmapText font from loader resource.\n *\n * @function parseBitmapFontData\n * @memberof PIXI.loaders\n * @param {PIXI.loaders.Resource} resource - Loader resource.\n * @param {PIXI.Texture|PIXI.Texture[]} textures - List of textures for each page.\n */\n\n\nfunction parse(resource, textures) {\n  resource.bitmapFont = _extras.BitmapText.registerFont(resource.data, textures);\n}","map":null,"metadata":{},"sourceType":"script"}